<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proximy Events</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #ffffff;
      min-height: 100vh;
      padding: 40px 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    h1 {
      color: #1a365d;
      text-align: center;
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 30px;
      letter-spacing: -1px;
    }
    
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 25px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 1px solid #f1f5f9;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .controls-left {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    
    .search-container {
      position: relative;
    }
    
    .search-input {
      padding: 12px 16px 12px 45px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 14px;
      color: #2d3748;
      background: white;
      transition: all 0.3s ease;
      min-width: 250px;
    }
    
    .search-input:focus {
      outline: none;
      border-color: #3182ce;
      box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
    }
    
    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #a0aec0;
      font-size: 16px;
    }
    
    .clear-search {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #a0aec0;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }
    
    .clear-search:hover {
      color: #3182ce;
      background: #f7fafc;
    }
    
    .sort-dropdown {
      position: relative;
      display: inline-block;
    }
    
    .sort-select {
      appearance: none;
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 12px 40px 12px 16px;
      font-size: 14px;
      font-weight: 500;
      color: #2d3748;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 200px;
    }
    
    .sort-select:hover {
      border-color: #3182ce;
    }
    
    .sort-select:focus {
      outline: none;
      border-color: #3182ce;
      box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
    }
    
    .sort-dropdown::after {
      content: '▼';
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #718096;
      pointer-events: none;
      font-size: 12px;
    }
    
    .filter-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .filter-btn {
      padding: 10px 18px;
      border: 2px solid #e2e8f0;
      background: white;
      color: #4a5568;
      border-radius: 25px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .filter-btn:hover {
      border-color: #3182ce;
      background: #f7fafc;
      transform: translateY(-1px);
    }
    
    .filter-btn.active {
      background: linear-gradient(135deg, #3182ce, #2c5282);
      color: white;
      border-color: #3182ce;
      box-shadow: 0 4px 15px rgba(49, 130, 206, 0.25);
    }
    
    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding: 0 5px;
    }
    
    .results-info {
      color: #718096;
      font-size: 14px;
      font-weight: 500;
    }
    
    .view-toggle {
      display: flex;
      gap: 8px;
    }
    
    .view-btn {
      padding: 8px 12px;
      border: 2px solid #e2e8f0;
      background: white;
      color: #4a5568;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .view-btn:hover {
      border-color: #3182ce;
    }
    
    .view-btn.active {
      background: #3182ce;
      color: white;
      border-color: #3182ce;
    }
    
    .events-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .event-card.list-view {
      display: flex;
      flex-direction: row;
      align-items: center;
      padding: 20px;
    }
    
    .event-card.list-view .event-image {
      width: 120px;
      height: 80px;
      flex-shrink: 0;
      margin-right: 20px;
    }
    
    .event-card.list-view .event-content {
      padding: 0;
      flex: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .event-card.list-view .event-meta {
      flex-direction: row;
      gap: 20px;
      margin: 0;
    }
    
    .event-card.list-view .event-actions {
      margin: 0;
      flex-shrink: 0;
    }
    
    .events-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 30px;
      padding: 0 10px;
    }
    
    .event-card {
      background: white;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }
    
    .event-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 30px 60px rgba(0,0,0,0.2);
    }
    
    .event-image {
      width: 100%;
      height: 220px;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .event-card:hover .event-image {
      transform: scale(1.05);
    }
    
    .event-content {
      padding: 25px;
      position: relative;
    }
    
    .event-badge {
      position: absolute;
      top: -12px;
      right: 20px;
      background: linear-gradient(135deg, #3182ce, #2c5282);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 4px 15px rgba(49, 130, 206, 0.3);
    }
    
    .event-badge.past {
      background: linear-gradient(135deg, #718096, #4a5568);
      box-shadow: 0 4px 15px rgba(113, 128, 150, 0.3);
    }
    
    .event-title {
      font-size: 1.4rem;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 15px;
      line-height: 1.3;
      display: -webkit-box;
     
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .event-meta {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .meta-item {
      display: flex;
      align-items: center;
      color: #7f8c8d;
      font-size: 14px;
      gap: 10px;
    }
    
    .meta-icon {
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, #3182ce, #2c5282);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 10px;
      flex-shrink: 0;
    }
    
    .event-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 20px;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
      flex: 1;
      min-width: 120px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #3182ce, #2c5282);
      color: white;
      box-shadow: 0 8px 20px rgba(49, 130, 206, 0.25);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(49, 130, 206, 0.35);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #38a169, #2f855a);
      color: white;
      box-shadow: 0 8px 20px rgba(56, 161, 105, 0.25);
    }
    
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(56, 161, 105, 0.35);
    }
    
    .loading, .error, .no-events {
      text-align: center;
      color: #2d3748;
      font-size: 1.2rem;
      padding: 60px 20px;
      background: rgba(247, 250, 252, 0.8);
      border-radius: 20px;
      border: 1px solid #e2e8f0;
      margin: 0 auto;
      max-width: 500px;
    }
    
    .error {
      background: rgba(254, 242, 242, 0.8);
      border: 1px solid #fed7d7;
      color: #c53030;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #e2e8f0;
      border-top: 4px solid #3182ce;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Mobile Responsiveness */
    @media (max-width: 768px) {
      body {
        padding: 20px 10px;
      }
      
      h1 {
        font-size: 2.2rem;
        margin-bottom: 30px;
      }
      
      .events-grid {
        grid-template-columns: 1fr;
        gap: 20px;
        padding: 0;
      }
      
      .event-content {
        padding: 20px;
      }
      
      .event-title {
        font-size: 1.2rem;
      }
      
      .event-actions {
        flex-direction: column;
      }
      
      .btn {
        min-width: auto;
      }
    }
    
    @media (max-width: 480px) {
      .event-card {
        border-radius: 15px;
      }
      
      .event-image {
        height: 180px;
      }
      
      .event-content {
        padding: 15px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>✨ Upcoming Events</h1>
    
    <div class="controls">
      <div class="controls-left">
        <div class="search-container">
          <span class="search-icon">🔍</span>
          <input 
            type="text" 
            id="searchInput" 
            class="search-input" 
            placeholder="Search events by name or location..."
          >
          <button class="clear-search" id="clearSearch" style="display: none;">✕</button>
        </div>
        
        <div class="sort-dropdown">
          <select id="sortSelect" class="sort-select">
              <option value="Default">📅 All Events</option>
             <option value="date-desc">📅 Upcoming Events</option>
            <option value="date-asc">📅 Past Events</option>
            <option value="name-asc">🔤 Name: A to Z</option>
            <option value="name-desc">🔤 Name: Z to A</option>
          </select>
        </div>
      </div>
      
      <div class="filter-buttons">
        <button class="filter-btn active" data-filter="all">All Events</button>
        <button class="filter-btn" data-filter="upcoming">Upcoming</button>
        <button class="filter-btn" data-filter="past">Past</button>
      </div>
    </div>
    
    <div class="results-header">
      <div class="results-info" id="resultsInfo"></div>
      <div class="view-toggle">
        <button class="view-btn active" data-view="grid">⊞ Grid</button>
        <button class="view-btn" data-view="list">☰ List</button>
      </div>
    </div>
    
    <div id="events">
      <div class="loading">
        <div class="loading-spinner"></div>
        Loading amazing events...
      </div>
    </div>
  </div>

  <script>
    const apiUrl = "https://us-central1-proximy-5b73d.cloudfunctions.net/api/api/events";
    let allEvents = [];
    let filteredEvents = [];

    // DOM elements
    const eventsDiv = document.getElementById("events");
    const sortSelect = document.getElementById("sortSelect");
    const resultsInfo = document.getElementById("resultsInfo");
    const searchInput = document.getElementById("searchInput");
    const clearSearch = document.getElementById("clearSearch");
    const filterButtons = document.querySelectorAll(".filter-btn");
    const viewButtons = document.querySelectorAll(".view-btn");

    let currentView = 'grid';
    let searchTerm = '';

    // Event listeners
    sortSelect.addEventListener("change", handleSort);
    searchInput.addEventListener("input", handleSearch);
    clearSearch.addEventListener("click", clearSearchInput);
    filterButtons.forEach(btn => btn.addEventListener("click", handleFilter));
    viewButtons.forEach(btn => btn.addEventListener("click", handleViewChange));

    function handleSearch() {
      searchTerm = searchInput.value.toLowerCase().trim();
      clearSearch.style.display = searchTerm ? 'block' : 'none';
      applyFilters();
    }

    function clearSearchInput() {
      searchInput.value = '';
      searchTerm = '';
      clearSearch.style.display = 'none';
      applyFilters();
    }

    function handleViewChange(e) {
      viewButtons.forEach(btn => btn.classList.remove('active'));
      e.target.classList.add('active');
      currentView = e.target.dataset.view;
      renderEvents(filteredEvents);
    }

    function handleSort() {
      const sortValue = sortSelect.value;
      sortEvents(filteredEvents, sortValue);
      renderEvents(filteredEvents);
    }

    function handleFilter(e) {
      // Update active filter button
      filterButtons.forEach(btn => btn.classList.remove("active"));
      e.target.classList.add("active");

      const filter = e.target.dataset.filter;
      applyFilters(filter);
    }

    function applyFilters(filter = null) {
      if (!filter) {
        filter = document.querySelector('.filter-btn.active').dataset.filter;
      }
      
      const now = new Date();
      let filtered = [...allEvents];

      // Apply search filter
      if (searchTerm) {
        filtered = filtered.filter(event => {
          const name = (event.name || '').toLowerCase();
          const location = (event.location || '').toLowerCase();
          return name.includes(searchTerm) || location.includes(searchTerm);
        });
      }

      // Apply date filter
      switch(filter) {
        case 'upcoming':
          filtered = filtered.filter(event => {
            const eventDate = new Date(event.endTime || event.startTime);
            return eventDate >= now;
          });
          break;
        case 'past':
          filtered = filtered.filter(event => {
            const eventDate = new Date(event.endTime || event.startTime);
            return eventDate < now;
          });
          break;
      }

      filteredEvents = filtered;

      // Apply current sorting
      const sortValue = sortSelect.value;
      sortEvents(filteredEvents, sortValue);
      renderEvents(filteredEvents);
      updateResultsInfo(filter, filteredEvents.length, searchTerm);
    }

    function sortEvents(events, sortType) {
      switch(sortType) {
        case 'date-asc':
          events.sort((a, b) => {
            const dateA = new Date(a.endTime || a.startTime || 0);
            const dateB = new Date(b.endTime || b.startTime || 0);
            return dateA - dateB;
          });
          break;
        case 'date-desc':
          events.sort((a, b) => {
            const dateA = new Date(a.endTime || a.startTime || 0);
            const dateB = new Date(b.endTime || b.startTime || 0);
            return dateB - dateA;
          });
          break;
        case 'name-asc':
          events.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
          break;
        case 'name-desc':
          events.sort((a, b) => (b.name || '').localeCompare(a.name || ''));
          break;
      }
    }

    function updateResultsInfo(filter, count, search = '') {
      let filterText = filter === 'all' ? 'all' : filter;
      const eventText = count === 1 ? 'event' : 'events';
      let searchText = search ? ` matching "${search}"` : '';
      resultsInfo.textContent = `Showing ${count} ${filterText} ${eventText}${searchText}`;
    }

    function renderEvents(events) {
      if (events.length === 0) {
        const activeFilter = document.querySelector('.filter-btn.active').textContent.toLowerCase();
        const searchText = searchTerm ? ` matching "${searchTerm}"` : '';
        eventsDiv.innerHTML = `<div class="no-events">🔍 No ${activeFilter}${searchText} found. Try adjusting your filters!</div>`;
        return;
      }

      const container = document.createElement('div');
      container.className = currentView === 'grid' ? 'events-grid' : 'events-list';

      events.forEach(event => {
        const eventDate = new Date(event.endTime || event.startTime);
        const now = new Date();
        const isPast = eventDate < now;
        
        // Format the date
        let dateText = "Date TBD";
        if (event.endTime || event.startTime) {
          const options = { 
            weekday: 'short', 
            month: 'short', 
            day: 'numeric',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          };
          dateText = eventDate.toLocaleDateString('en-US', options);
        }

        // Create action buttons
        let actionsHtml = '';
        if (event.joinURL || event.hostURL) {
          actionsHtml = '<div class="event-actions">';
          if (event.joinURL) {
            actionsHtml += `<a href="${event.joinURL}" class="btn btn-primary" target="_blank" rel="noopener noreferrer">🎯 Join Event</a>`;
          }
          if (event.hostURL) {
            actionsHtml += `<a href="${event.hostURL}" class="btn btn-secondary" target="_blank" rel="noopener noreferrer">👑 Host View</a>`;
          }
          actionsHtml += '</div>';
        }

        const card = document.createElement('div');
        card.className = `event-card ${currentView === 'list' ? 'list-view' : ''}`;
        
        if (currentView === 'list') {
          card.innerHTML = `
            <img src="${event.imageUrl || 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=400&h=220&fit=crop'}" 
                 alt="${event.name || 'Event'}" 
                 class="event-image"
                 onerror="this.src='https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=400&h=220&fit=crop'">
            
            <div class="event-content">
              <div>
                <div class="event-badge ${isPast ? 'past' : ''}">${isPast ? 'Past' : 'Upcoming'}</div>
                <h3 class="event-title">${event.name || "Amazing Event"}</h3>
                
                <div class="event-meta">
                  <div class="meta-item">
                    <div class="meta-icon">📅</div>
                    <span>${dateText}</span>
                  </div>
                  ${event.location ? `
                  <div class="meta-item">
                    <div class="meta-icon">📍</div>
                    <span>${event.location}</span>
                  </div>
                  ` : ''}
                  ${event.guestsToBring ? `
                  <div class="meta-item">
                    <div class="meta-icon">👥</div>
                    <span>Guests: ${event.guestsToBring}</span>
                  </div>
                  ` : ''}
                </div>
              </div>
              
              ${actionsHtml}
            </div>
          `;
        } else {
          card.innerHTML = `
            <img src="${event.imageUrl || 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=400&h=220&fit=crop'}" 
                 alt="${event.name || 'Event'}" 
                 class="event-image"
                 onerror="this.src='https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=400&h=220&fit=crop'">
            
            <div class="event-content">
              <div class="event-badge ${isPast ? 'past' : ''}">${isPast ? 'Past' : 'Upcoming'}</div>
              
              <h3 class="event-title">${event.name || "Amazing Event"}</h3>
              
              <div class="event-meta">
                <div class="meta-item">
                  <div class="meta-icon">📅</div>
                  <span>${dateText}</span>
                </div>
                
                ${event.location ? `
                <div class="meta-item">
                  <div class="meta-icon">📍</div>
                  <span>${event.location}</span>
                </div>
                ` : ''}
                
                ${event.guestsToBring ? `
                <div class="meta-item">
                  <div class="meta-icon">👥</div>
                  <span>Guests: ${event.guestsToBring}</span>
                </div>
                ` : ''}
              </div>
              
              ${actionsHtml}
            </div>
          `;
        }
        
        container.appendChild(card);
      });

      eventsDiv.innerHTML = '';
      eventsDiv.appendChild(container);
    }

    // Initial fetch
    fetch(apiUrl, {
      method: "GET",
      headers: {
        "X-API-Key": "proximy-api-key-2024"
      }
    })
    .then(response => response.json())
    .then(data => {
      console.log("API Response:", data);

      if (data.data && Array.isArray(data.data)) {
        allEvents = data.data;
        filteredEvents = [...allEvents];
        
        // Default sort by upcoming first
        sortEvents(filteredEvents, 'date-asc');
        renderEvents(filteredEvents);
        updateResultsInfo('all', filteredEvents.length);
      } else {
        eventsDiv.innerHTML = '<div class="error">❌ Oops! Unable to load events. Please try again later.</div>';
      }
    })
    .catch(error => {
      console.error("Error fetching events:", error);
      eventsDiv.innerHTML = '<div class="error">❌ Connection failed. Please check your internet and try again.</div>';
    });
  </script>
</body>
</html>